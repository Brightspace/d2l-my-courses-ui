<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="d2l-course-tile-grid.html">
<link rel="import" href="d2l-course-tile-responsive-grid-behavior.html">
<link rel="import" href="localize-behavior.html">
<link rel="import" href="d2l-course-management-behavior.html">

<!--
`<d2l-all-courses>` displays both pinned and unpinned courses

@demo demo/d2l-all-courses-demo.html
-->
<dom-module id="d2l-all-courses">
	<template>
		<style>
			:host {
				display: block;
			}
			h2 {
				/* overrides to d2l-heading-3 */
				margin: 20px 0 10px 0;
				font-size: 20px;
				/* end overrides */
			}
			d2l-alert {
				margin-bottom: 20px;
			}
		</style>

		<h2 class="d2l-heading-3">{{localize('pinnedCourses')}}</h2>

		<template is="dom-if" if="[[!_hasPinnedEnrollments]]">
			<d2l-alert visible="[[!_hasPinnedEnrollments]]">
				{{localize('noPinnedCoursesMessage')}}
			</d2l-alert>
		</template>

		<d2l-course-tile-grid
			enrollments="{{pinnedEnrollments}}"
			enrollments-queue="{{pinnedEnrollmentsQueue}}"
			delay-course-tile-load="[[delayCourseTileLoad]]">
		</d2l-course-tile-grid>

		<h2 class="d2l-heading-3">{{localize('unpinnedCourses')}}</h2>

		<d2l-course-tile-grid
			enrollments="{{unpinnedEnrollments}}"
			enrollments-queue="{{unpinnedEnrollmentsQueue}}"
			delay-course-tile-load="[[delayCourseTileLoad]]">
		</d2l-course-tile-grid>
	</template>

	<script>
		'use strict';

		Polymer({
			is: 'd2l-all-courses',
			properties: {
				/*
				* Sets the delay-load property on the course tile grid
				* @type {Boolean}
				*/
				delayCourseTileLoad: {
					type: Boolean,
					value: true
				}
			},
			behaviors: [
				Polymer.D2L.MyCourses.CourseTileResponsiveGridBehavior,
				Polymer.D2L.MyCourses.LocalizeBehavior,
				Polymer.D2L.MyCourses.CourseManagementBehavior
			],
			ready: function() {
				this.usePendingLists = true;

				// Both course tile grids in this view should have the same number of columns, so use a custom getter
				var courseTileGrids = Polymer.dom(this.root).querySelectorAll('d2l-course-tile-grid');
				for (var i = 0; i < courseTileGrids.length; i++) {
					courseTileGrids[i].getCourseTileItemCount = this.getCourseTileItemCount.bind(this);
				}
			},
			/*
			* Fetches set of focusable elements (all `<d2l-course-tile>`s)
			*
			* Required for accessibility, this specifies which elements within the element are intended to be
			* keyboard-focusable. This is because we're using `<iron-overlay with-backdrop>`. See
			* [those docs](https://github.com/PolymerElements/iron-overlay-behavior#backdrop) for more information.
			*
			* @return {Array<HTMLElement>} `<d2l-course-tile` HTMLElements
			*/
			focusableNodesOverride: function() {
				var courseTileFocusables = [];

				Polymer.dom(this.root).querySelectorAll('d2l-course-tile').forEach(function(courseTile) {
					Array.prototype.push.apply(courseTileFocusables, Polymer.dom(courseTile.root).querySelectorAll('a'));
				});

				return courseTileFocusables;
			},
			/*
			* Fetches the max value between the pinned and unpinned enrollments
			* @return {Number} Max(number of pinned enrollments, number of unpinned enrollments)
			*/
			getCourseTileItemCount: function() {
				var itemCount = Math.max(this.pinnedEnrollments.length, this.unpinnedEnrollments.length);

				return itemCount;
			},
			loadCourseTiles: function() {
				this.delayCourseTileLoad = false;
			}
		});
	</script>
</dom-module>
