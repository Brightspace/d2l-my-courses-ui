<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="d2l-all-courses-styles.html">
<link rel="import" href="d2l-course-tile-grid.html">
<link rel="import" href="d2l-course-tile-responsive-grid-behavior.html">
<link rel="import" href="localize-behavior.html">
<link rel="import" href="d2l-course-management-behavior.html">

<dom-module id="d2l-all-courses">
	<template>
		<style include="d2l-all-courses-styles"></style>

		<div class="dialog-content">
			<h2 class="d2l-heading-3">{{localize('pinnedCourses')}}</h2>
			<d2l-course-tile-grid
				course-entities="{{pinnedCoursesEntities}}"
				course-entities-queue="{{pinnedCoursesEntitiesQueue}}"
				alert-visible="{{!_hasPinnedCourses}}"
				alert-message="{{localize('noPinnedCoursesMessage')}}">
			</d2l-course-tile-grid>

			<h2 class="d2l-heading-3">{{localize('unpinnedCourses')}}</h2>
			<d2l-course-tile-grid
				course-entities="{{unpinnedCoursesEntities}}"
				course-entities-queue="{{unpinnedCoursesEntitiesQueue}}">
			</d2l-course-tile-grid>
		</div>
	</template>

	<script>
		Polymer({
			is: 'd2l-all-courses',
			behaviors: [
				Polymer.D2L.MyCourses.CourseTileResponsiveGridBehavior,
				Polymer.D2L.MyCourses.LocalizeBehavior,
				Polymer.D2L.MyCourses.CourseManagementBehavior
			],
			ready: function() {
				this.usePendingLists = true;
			},
			created: function() {
				Polymer.dom(this.root).querySelectorAll('d2l-course-tile-grid').forEach(function(courseTileGrid) {
					// Use global course tile count for each course tile grid
					courseTileGrid.getCourseTileItemCount = this.getCourseTileItemCount.bind(this);
				}.bind(this));
			},
			focusableNodesOverride: function() {
				var courseTileFocusables = [];

				Polymer.dom(this.root).querySelectorAll('d2l-course-tile').forEach(function(courseTile) {
					Array.prototype.push.apply(courseTileFocusables, Polymer.dom(courseTile.root).querySelectorAll('a'));
				});

				return courseTileFocusables;
			},
			_getOverlayWidth: function() {
				return this._getAvailableWidth(this.$$('.dialog-content'));
			},
			getCourseTileItemCount: function() {
				var itemCount = 0;

				if (this.pinnedCoursesEntities && this.unpinnedCoursesEntities) {
					itemCount = Math.max(this.pinnedCoursesEntities.length, this.unpinnedCoursesEntities.length);
				}

				return itemCount;
			},
			_rescaleCourseTileRegions: function(forcedWidth) {
				var itemCount = this.getCourseTileItemCount();
				var courseTileRegions = Polymer.dom(this.root).querySelectorAll('d2l-course-tile-grid');

				Array.prototype.forEach.call(courseTileRegions, function(courseTileRegion) {
					courseTileRegion._rescaleCourseTileRegions(forcedWidth, itemCount);
				});
			}
		});
	</script>
</dom-module>
