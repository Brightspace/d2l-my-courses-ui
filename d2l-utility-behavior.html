<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../d2l-siren-parser/d2l-siren-parser.html">

<script>
	'use strict';

	window.D2L = window.D2L || {};
	window.D2L.MyCourses = window.D2L.MyCourses || {};

	/*
	* General utility functions that can be used in many places.
	*
	* No specific requirements or restrictions on what goes in here.
	*
	* @polymerBehavior
	*/
	window.D2L.MyCourses.UtilityBehavior = {
		/*
		* Creates a URL with a query from an Action and an object of required parameters
		* @param {Action} action
		* @param {Object} parameters Query parameters, as { parameterName: desiredValue, ... }
		*/
		createActionUrl: function(action, parameters) {
			parameters = parameters || {};
			action.fields = action.fields || [];
			var query = {};

			action.fields.forEach(function(field) {
				if (parameters.hasOwnProperty(field.name)) {
					query[field.name] = parameters[field.name];
				} else {
					query[field.name] = field.value;
				}
			});

			var queryString = Object.keys(query).map(function(key) {
				return key + '=' + query[key];
			}).join('&');

			return queryString ? action.href + '?' + queryString : action.href;
		},
		getImageSrcset: function(image, imageClass) {
			if (!image) {
				return '';
			}
			var srcset = '',
				imageLinks = image.getLinksByClass(imageClass || 'tile'),
				sizes = {};
			imageLinks.forEach(function(link) {
				var size = link.hasClass('min') && 'Min' || link.hasClass('mid') && 'Mid' || link.hasClass('max') && 'Max',
					density = link.hasClass('high-density') ? 'high' : 'low';
				sizes[density + size] = link.href;
			});
			if (imageClass === 'tile') {
				srcset += sizes.lowMin ? sizes.lowMin + ' 145w, ' : '';
				srcset += sizes.highMin ? sizes.highMin + ' 290w, ' : '';
				srcset += sizes.lowMid ? sizes.lowMid + ' 220w, ' : '';
				srcset += sizes.highMid ? sizes.highMid + ' 440w, ' : '';
				srcset += sizes.lowMax ? sizes.lowMax + ' 540w, ' : '';
				srcset += sizes.highMax ? sizes.highMax + ' 1080w, ' : '';
			}
			if (imageClass === 'narrow') {
				srcset += sizes.lowMin ? sizes.lowMin + ' 320w, ' : '';
				srcset += sizes.highMin ? sizes.highMin + ' 640w, ' : '';
				srcset += sizes.lowMid ? sizes.lowMid + ' 375w, ' : '';
				srcset += sizes.highMid ? sizes.highMid + ' 750w, ' : '';
				srcset += sizes.lowMax ? sizes.lowMax + ' 767w, ' : '';
				srcset += sizes.highMax ? sizes.highMax + ' 1534w, ' : '';
			}
			return srcset.replace(/,\s*$/, '');
		},
		/*
		* Returns the best available image to use as a default
		* @param {Entity} image
		* @return {String}
		*/
		getDefaultImageLink: function(image, imageClass) {
			var imageLinks = image.getLinksByClass(imageClass || 'tile'),
				sizes = {};
			imageLinks.forEach(function(link) {
				var size = link.hasClass('min') && 'Min' || link.hasClass('mid') && 'Mid' || link.hasClass('max') && 'Max',
					density = link.hasClass('high-density') ? 'high' : 'low';
				sizes[density + size] = link.href;
			});
			return sizes.highMax || sizes.lowMax || sizes.highMid || sizes.lowMid || sizes.highMin || sizes.lowMin;
		},
		/*
		* Creates a unique identifier for a Siren Entity (really just the self Link href)
		* @param {Entity}
		* @return {String}
		*/
		getEntityIdentifier: function(entity) {
			// An entity's self href should be unique, so use it as an identifier
			var selfLink = entity.getLinkByRel('self');
			return selfLink.href;
		}
	};
</script>
