<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="d2l-image-selector-tile.html">
<link rel="import" href="../../d2l-ajax/d2l-ajax.html">

<dom-module id="d2l-image-tile-grid">
	<template>
		<style>
		:host {
			--breakpoint-gutter-width: 1.3%;

			/*
			*	100% = n(tile width) + 2n(margin) - 2(margin),
			*	see d2l-course-tile-grid-styles.html for a more in-depth description
			*/
			--breakpoint-two-column-width: 48.7%;
			--breakpoint-three-column-width: 31.6%;

			/*
				Height has to be 73% of the width to maintain the image aspect ratio,
				use padding, as it sizes in relation to the width of the screen as opposed to the height (yay css!)
			*/
			--breakpoint-one-column-height: 73%;
			--breakpoint-two-column-height: 35.551%;
			--breakpoint-three-column-height: 23.068%;
		}

		.grid-child {
			width: 100%;
		}

		.grid-container {
			position: relative;
			width: calc(100% + 20px);
			display: flex;
			flex-wrap: wrap;
			flex-direction: row;
			align-items: flex-start;
		}

		.responsive-columns-3-2-1 {
			/* This needs to be a block so that we get the width-based padding-top for it's children on firefox */
			display: block;
		}

		.responsive-columns-3-2-1 > .grid-child {
			height: auto;
			position: relative;
			display: inline-block;
		}

		@media screen and (min-width: 992px) {
			.responsive-columns-3-2-1 {
				padding: 0 20px;
			}

			.responsive-columns-3-2-1 > .grid-child {
				width: var(--breakpoint-three-column-width);
				padding-top: var(--breakpoint-three-column-height);
				margin: var(--breakpoint-gutter-width);
			}

			.responsive-columns-3-2-1 > .grid-child:nth-child(3n) {
				margin-right: 0;
			}

			.responsive-columns-3-2-1 > .grid-child:nth-child(3n+1) {
				margin-left: 0;
			}
		}

		@media screen and (max-width: 991px) and (min-width: 768px) {
			.responsive-columns-3-2-1 {
				padding: 0 20px;
			}

			.responsive-columns-3-2-1 > .grid-child {
				width: var(--breakpoint-two-column-width);
				padding-top: var(--breakpoint-two-column-height);
				margin: var(--breakpoint-gutter-width);
			}

			.responsive-columns-3-2-1 > .grid-child:nth-child(2n) {
				margin-right: 0;
			}

			.responsive-columns-3-2-1 > .grid-child:nth-child(2n+1) {
				margin-left: 0;
			}
		}

		@media screen and (max-width: 767px) {
			.responsive-columns-3-2-1 > .grid-child {
				width: 100%;
				padding-top: var(--breakpoint-one-column-height);
				margin: var(--breakpoint-gutter-width) 0;
			}
		}
		</style>

		<d2l-ajax
			id="imagesRequest"
			url="[[_courseImageCatalogLocation]]"
			headers='{ "Accept": "application/vnd.siren+json" }'
			on-iron-ajax-response="_onImagesRequestResponse">
		</d2l-ajax>

		<div class="image-selector-tile-container responsive-columns-3-2-1 grid-container">
			<template id="enrollmentsTemplate" is="dom-repeat" items="[[images]]">
				<d2l-image-selector-tile
					image="[[item]]"
					class="grid-child">
				</d2l-image-selector-tile>
			</template>
		</div>

	</template>
	<script>
		'use strict';

		Polymer({
			is: 'd2l-image-tile-grid',
			properties: {
				images: {
					type: Array
				},
				_courseImageCatalogLocation: {
					type: String,
					value: ''
				},
				_sirenParser: {
					type: Object,
					value: document.createElement('d2l-siren-parser')
				}
			},
			ready: function() {
				// TODO: Hook these up to on open
				this._courseImageCatalogLocation = this._getSearchStringValue('fabric');
				this.$.imagesRequest.generateRequest();
			},
			_onImagesRequestResponse: function(response) {
				if (response.detail.status === 200) {
					this.images = this._sirenParser.parse(response.detail.xhr.response).entities || [];
				}
			},
			_getSearchStringValue: function(search) {
				return 'http://course-image-catalog-dev2.us-east-1.elasticbeanstalk.com/images?searchString=' + search;
			}
		});
	</script>
</dom-module>
